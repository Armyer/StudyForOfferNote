### Redis简介
本质上就是一个数据库，只不过传统的数据库数据存放在磁盘上，而redis数据是存在内存中，因而读写速度非常快。被广泛用于缓存方向。以及用来做分布式锁。除此以外，还支持事务、持久化、LUA脚本、LRU驱动事件、多种集群方案。

### Redis的意义，为什么要用Redis？
两方面：

| 名称 |说明  |
| --- | --- |
|高性能  |从硬盘读取速度较慢，将数据存在缓存中，直接从缓存拿速度较快。操作缓存就是直接操作内存。如果数据库中的对应数据改变，则同步改变缓存中的相应数据即可。  |
|高并发  |直接操作缓存能够承受的请求是远远大于直接访问数据库的。把数据库中的部分数据转移到缓存中去，这样用户的一部分请求会直接到缓存这里而不用经过数据库。  |

### 为什么使用Redis而不是map/guava做缓存？

缓存分为本地缓存和分布式缓存。

以Java为例，使用自带的map/guava实现的是**本地缓存**，最主要的特点是轻量以及快速、生命周期随着JVM的销毁而结束，并且在多实例的情况下，每个实例都需要各自保存一份缓存、**缓存不具有一致性**。

使用redis/memcached之类的称为**分布式缓存**，在多实例的情况下，各实例公用一份缓存数据，**缓存具有一致性**。缺点是需要保持redis/memcached服务的高可用，整个程序架构较为复杂。


### redis和memcached区别


| 名称 |redis  | mecached |
| --- | --- | --- |
| 数据类型 |更丰富，支持更复杂的应用场景。不仅支持k/v类型数据，同时还提供了list,set,zset,hash等数据结构的存储。  |memcached支持简单的数据类型，String  |
|数据持久化  |将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用  |把数据全部存在内存之中  |
|集群模式  |目前是原生支持cluster模式  |没有原生的集群模式，需要依靠客户端来实现往集群中分片写入数据  |
|线程  |使用单线程的多路IO复用模型  |非阻塞IO复用的网络模型  |

![image](https://github.com/awqcs/Study-for-Offer/blob/master/Jarmyer/image/redis-memcached.JPG)

### redis的线程模型

redis内部使用文件事件处理器file,event,handler，这个文件事件处理器是单线程的，所以redis才叫做单线程的模型。采用IO多路复用机制同时监听多个socket，根据socket上的事件来选择对应的事件处理器进行处理。

文件事件处理器的结构包含4个部分：

* 多个socket
* IO多路复用程序
* 文件事件分派器
* 事件处理器

多个socket可能会并发产生不同的操作，每个操作对应不同的文件事件，但是IO多路复用程序监听多个socket，会将socket产生的事件放入队列中排队，事件分派器每次从队列中取出一个事件、把该事件交给对应的事件处理器进行处理。

### Redis常见数据结构以及使用场景分析


| 名称 |常用命令  |说明  |
| --- | --- | --- |
|String  |set, get, decr, incr, mget  | 数据结构是简单的ley-value类型，value不仅可以是String，也可以是数字。应用举例：常规计数、微博数、粉丝数等 |
|Hash  |hget, hset, hgetall  |是一个string类型的field和value映射表，hash特别适用于存储对象，后续操作的时候，可以直接仅仅修改这个对象中的某个字段的值。  |
| List |lpush,rpush,lpop.rpop,lrange  |即为链表，Redis List 应用场景非常多，也是Redis最重要的数据结构之一。应用举例：微薄的关注列表，粉丝聊表，消息队列等。实现为一个双向链表，即支持反向查找和遍历，更方便操作，不过需要额外的内存开销。  |
| Set | sadd, spop, smembers,sunion |对外提供的功能与list类似是一个列表的功能，特殊之处在于set是可以自动排重的。基于set轻易实现交集、并集、差集的操作。 |
|Sorted Set |zadd, zrange, zrem,zcard  |和set相对，sorted set增加了一个权重参数score，使得集合中的元素能够score进行有序排列。举例：直播系统中，实时排行信息包含直播间在线用户列表，各种礼物排行榜，弹幕消息等。 |